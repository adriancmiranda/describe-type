<html>
	<head>

	</head>
	<body>
		<script>
			console.clear();

			var ObjectProto = Object.prototype;
			var objectHasOwnProperty = ObjectProto.hasOwnProperty;
			var CONSTRUCTOR = 'constructor';
			var __PROTO__ = '__proto__';

			if (typeof Object.getPrototypeOf === 'function' === false) {
				Object.getPrototypeOf = ''.__proto__ === String.prototype
				? function getPrototypeOf(value) {
					return value.__proto__;
				}
				: function getPrototypeOf(value) {
					if (objectHasOwnProperty.call(value, CONSTRUCTOR)) {
						return ObjectProto;
					}
					return value.constructor.prototype;
				};
			}

			var objectGetPrototypeOf = Object.getPrototypeOf;
			function getProtoOf(value) {
				var ctor = value.constructor;
				if (ctor === undefined) return ObjectProto;
				return objectGetPrototypeOf(value) || (function polyfill() {
					if (objectHasOwnProperty.call(value, CONSTRUCTOR)) {
						return ObjectProto;
					}
					return ctor.prototype;
				})();
			}
		</script>
		<script>
			// var evilObject = { constructor: null, __proto__: 'proto_foo', getPrototypeOf: 'get_foo' };
			var evilObject = { constructor: function test(){}, __proto__: 'proto_foo', getPrototypeOf: 'get_foo' };
			var regexp = /re/g;
			console.log('Object.getPrototypeOf(evilObject)-->', Object.getPrototypeOf(evilObject));
			console.log('Object.getPrototypeOf(evilObject)-->', Object.getPrototypeOf(evilObject) === ObjectProto);
			console.log('Object.getPrototypeOf(regexp)-->', Object.getPrototypeOf(regexp) === RegExp.prototype);
			console.log('getProtoOf(evilObject)-->', getProtoOf(evilObject));
			console.log('getProtoOf(evilObject)-->', getProtoOf(evilObject) === ObjectProto);
			console.log('getProtoOf(regexp)-->', getProtoOf(regexp) === RegExp.prototype);
			console.log('Object.prototype === RegExp.prototype-->', ObjectProto === RegExp.prototype);
		</script>
	</body>
</html>
